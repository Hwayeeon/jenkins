---
title: "@upstash/kafka"
description: Klien Kafka yang sepenuhnya bertipe, dibangun untuk Upstash Kafka dan HTTP, sempurna untuk runtime serverless dan edge
date: "2022-01-08"
url: https://upstash.com/kafka
repository: upstash/upstash-kafka
published: true

---


Klien Kafka berbasis HTTP/REST yang dibangun di atas
[Upstash REST API](https://docs.upstash.com/kafka/rest).

Ini adalah satu-satunya klien Kafka tanpa koneksi (berbasis HTTP) dan dirancang untuk:

- Fungsi serverless (AWS Lambda ...)
- Cloudflare Workers (lihat contohnya)
- Fastly Compute@Edge
- Next.js Edge, Remix ...
- Aplikasi web/mobile sisi klien
- WebAssembly dan environment lain di mana HTTP lebih disukai daripada koneksi TCP.

# Instalasi

```bash
npm install @upstash/kafka
```

# Quickstart

## Auth

1. Pergi ke [upstash](https://console.upstash.com/kafka) dan pilih database Anda.
2. Salin secret `REST API` di bagian bawah halaman

```typescript
import { Kafka } from "@upstash/kafka"

const kafka = new Kafka({
  url: "<UPSTASH_KAFKA_REST_URL>",
  username: "<UPSTASH_KAFKA_REST_USERNAME>",
  password: "<UPSTASH_KAFKA_REST_PASSWORD>",
})
```

## Produce satu pesan

```typescript
const p = kafka.producer()
const message = { hello: "world" } // Object akan diserialisasi menggunakan `JSON.stringify`
const res = await p.produce("<my.topic>", message)
const res = await p.produce("<my.topic>", message, {
  partition: 1,
  timestamp: 12345,
  key: "<custom key>",
  headers: [{ key: "traceId", value: "85a9f12" }],
})
```

## Produce banyak pesan

Opsi yang sama dari contoh di atas dapat diatur untuk setiap pesan.

```typescript
const p = kafka.producer()
const res = await p.produceMany([
  {
    topic: "my.topic",
    value: { hello: "world" },
    // ...options
  },
  {
    topic: "another.topic",
    value: "another message",
    // ...options
  },
])
```

## Consume

Pertama kali consumer dibuat, perlu mencari tahu koordinator grup
dengan bertanya ke broker Kafka dan bergabung dengan consumer group. Proses
ini membutuhkan waktu untuk selesai. Itulah mengapa ketika instance consumer
dibuat pertama kali, mungkin mengembalikan pesan kosong sampai koordinasi
consumer group selesai.

```typescript
const c = kafka.consumer()
const messages = await c.consume({
  consumerGroupId: "group_1",
  instanceId: "instance_1",
  topics: ["test.topic"],
  autoOffsetReset: "earliest",
})
```

Lebih banyak contoh dapat ditemukan di
[docstring](https://github.com/upstash/upstash-kafka/blob/main/pkg/consumer.ts#L265)

## Commit secara manual

Sementara `consume` dapat menangani commit secara otomatis, Anda juga dapat menggunakan
`Consumer.commit` untuk commit secara manual.

```typescript
const consumerGroupId = "mygroup"
const instanceId = "myinstance"
const topic = "my.topic"

const c = kafka.consumer()
const messages = await c.consume({
  consumerGroupId,
  instanceId,
  topics: [topic],
  autoCommit: false,
})

for (const message of messages) {
  // logika penanganan pesan

  await c.commit({
    consumerGroupId,
    instanceId,
    offset: {
      topic: message.topic,
      partition: message.partition,
      offset: message.offset,
    },
  })
}
```

## Fetch

Anda juga dapat mengelola offset secara manual dengan menggunakan `Consumer.fetch`

```typescript
const c = kafka.consumer()
const messages = await c.fetch({
  topic: "greeting",
  partition: 3,
  offset: 42,
  timeout: 1000,
})
```

## Contoh

Lihat [/examples](https://github.com/upstash/upstash-kafka/tree/main/examples) serta
berbagai contoh di docstring setiap method.

# Kontribusi

## Persyaratan

- [nodejs](https://nodejs.org) v14.x atau lebih tinggi
- [pnpm](https://pnpm.io/installation)

## Setup

0. Instal dependensi menggunakan `pnpm install`
1. Buat instance kafka di upstash.
   [docs](https://docs.upstash.com/kafka#create-a-kafka-cluster)
2. Buat topic berikut: `blue`, `red`, `green`.
   [docs](https://docs.upstash.com/kafka#create-a-topic)

   Pengaturan partisi atau retensi tidak penting saat ini.

3. Buat file `.env` dengan secret kafka Anda `cp .env.example .env`

## Menjalankan test

```bash
pnpm test
```
